<html>
  <head>
    <!-- This ejs statement includes header partial.
    Varibale declaration decides which page is active !-->
    <% include head.ejs %>
    <% var page = "calculator"%>
    <% var active = " active"%>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
    <script>
      function unhideCanvas(){
        document.getElementById('myChart').style.display = "block";
        console.log(document.getElementById("monthlysuper").value);
      }
    </script>
  </head>
  <body>
    <% include header.ejs %>
    <div class = "container" style="width:50%;margin-left:7%;">
      <h1>About:</h1>
      <p>This calculator is a guide to teach the user that how much he can save if pays extra on the top of his
        super.</p>
      <h1>How to use:</h1>
      <p>Just enter your annual salary and how much salary sacrifice you would like to conttibute to your super. We will calculate the
        annual stats for you.</p>
      <form name = "loginForm" method = "post">
        <div class ="container" style="width:100%;height:5%;margin-left:-3%;margin-top:5%;">
          <input id = "monthlysalary" style="width:200px" type="number" min = "0" name = "monthlysalary" class="form-control loginPageUserNameInputBox" placeholder="Annual Salary">
          <input id = "monthlysuper" style="width:200px" type="number"min = "0" name = "monthlysuper" class="form-control loginPagePasswordInputBox" placeholder="Salary Sacrifice">
          <button onclick="DrawChart();" class="btn-primary loginPageSubmitButton">Submit &#x2192</button>
        </div>
      </form>
    </div>
    <div>
     <div class="container">
        <div>
          <canvas style = "display:none" id="myChart"></canvas>
        </div>
      </div>
    </div>
    <% include footer.ejs %>
  </body>
  <script>
  function DrawChart(){
    var monthsalsac = parseInt(document.getElementById("monthlysuper").value);
    var annsal = 0;
    var annsalsac = 0;
    var contributemonth = 0;
    var contributeannual = 0;
    var gainloss = 0;
    // First line for without contribution, second for with contribution.
    var taxincome = [0, 0];
    var tax = [0, 0];
    var medilevy = [0, 0];
    var superbal = [0, 0];
    var superbaltax = [0, 0];
    var netsuperbal = [0, 0];
    var netsalary = [0, 0];
    var yourasset = [0, 0];
    annsal = parseInt(document.getElementById("monthlysalary").value) ;
    annsalsac = monthsalsac * 12;
    contributeannual = annsal * 0.095;
    taxincome[1] = annsal - annsalsac;
    taxincome[0] = annsal - 0;
    superbal[1] = contributeannual + annsalsac;
    superbal[0] = contributeannual;
    if (annsal < 18201)
    {
    	tax[1] = 0;
    }
    else if (annsal < 37001)
    {
    	tax[1] = (taxincome[1] - 18200) * 0.19;
    }
    else if (annsal < 80001)
    {
    	tax[1] = ((taxincome[1] - 37000) * 0.325) + 3572;
    }
    else if (annsal < 180001)
    {
    	tax[1] = ((taxincome[1] - 87000) * 0.37) + 19822;
    }
    else
    {
    	tax[1] = ((taxincome[1] - 180000) * 0.45) + 54232;
    }
    if (annsal < 18201)
    {
    	tax[0] = 0;
    }
    else if (annsal < 37001)
    {
    	tax[0] = (taxincome[0] - 18200) * 0.19;
    }
    else if (annsal < 80001)
    {
    	tax[0] = ((taxincome[0] - 37000) * 0.325) + 3572;
    }
    else if (annsal < 180001)
    {
    	tax[0] = ((taxincome[0] - 87000) * 0.37) + 19822;
    }
    else
    {
    	tax[0] = ((taxincome[0] - 180000) * 0.45) + 54232;
    }
    medilevy[1] = taxincome[1] * 0.02;
    medilevy[0] = taxincome[0] * 0.02;
    superbaltax[1] = annsalsac * 0.15;
    superbaltax[0] = 0 * 0.15;
    netsuperbal[1] = superbal[1] - superbaltax[1];
    netsuperbal[0] = superbal[0] - superbaltax[0];
    netsalary[1] = taxincome[1] - tax[1] - medilevy[1];
    netsalary[0] = taxincome[0] - tax[0] - medilevy[0];
    yourasset[1] = netsuperbal[1] + netsalary[1];
    yourasset[0] = netsuperbal[0] + netsalary[0];
    gainloss = yourasset[1] - yourasset[0];
    var stats = {
      annualSalary:annsal,
      tax:tax,
      mediLevy:medilevy,
      superBalanceTax:superbaltax,
      netSuperBalance:netsuperbal,
      netSalary:netsalary,
      yourAsset:yourasset,
      gainLoss:gainloss
    };
    console.log(stats);
    var ctx = document.getElementById('myChart').getContext('2d');
    document.getElementById('myChart').style.display = 'block';
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Net salary', 'Net super balance', 'Tax', 'Medicare'],
        datasets: [{
          label: 'Without contribution',
          data: [stats.netSalary[0], stats.netSuperBalance[0], stats.tax[0], stats.mediLevy[0]],
          backgroundColor: "rgba(153,255,51,0.6)"
        }, {
          label: 'With contribution',
          data: [stats.netSalary[1], stats.netSuperBalance[1], stats.tax[1], stats.mediLevy[1]],
          backgroundColor: "rgba(255,153,0,0.6)"
        }]
      }
    });
  }
  </script
</html>
