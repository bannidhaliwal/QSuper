<html>
  <head>
    <!-- This ejs statement includes header partial.
    Varibale declaration decides which page is active !-->
    <% include head.ejs %>
    <% var page = 'gamepage'%>
    <% var active = " active"%>
  </head>
  <body>
    <% include header.ejs %>
    <div class = "container containerExtensionForContentArea" style = "background-color:white;">
      <div class = "gameCanvasWrapper">
        <!-- It is important that the dimesnions of the canvas remains same.
          if you want to change the dimensions, you have to change the functions at
          the backend as well..
          Dimensions are 400 x 400 in case if someone changes it..
        !-->
        <canvas id = "canvas" width="400" height = "400"></canvas>
      </div>
      <div class = "gameControllers">
      </div>
    </div>
    <% include footer.ejs %>
    <!--This images will be used to draw on canvas.
        We are not showing this images that is why the display property is none.
    !-->
    <img style="display:none" id = "balance" src="/balance.png"></img>
    <img style="display:none" id = "cash" src="/cash.png"></img>
    <img style="display:none" id = "cocontribution" src="/cocontribution.png"></img>
    <img style="display:none" id = "conservative" src="/conservative.png"></img>
    <img style="display:none" id = "growth" src="/growth.png"></img>
    <img style="display:none" id = "salarysacrifice" src="/salarysacrifice.png"></img>
    <img style="display:none" id = "empty" src="/empty.png"></img>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/AnimationFunctions.js"></script>
  <script>
      var socket = io.connect();
      var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
      document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
      document.getElementById("empty")];

      //Swap animation for the swapping elements..
      socket.on("SwapAnimation",function(data){
        var canvas = document.getElementById("canvas").getContext("2d");
        SwapObjects(data,canvas,img);
      });

      //Highlight the selected item
      socket.on("Highlight",function(data){
        var canvas = document.getElementById("canvas").getContext("2d");
        Highlight(data,canvas,img,"#33FFA5");
      });

      //Dehighlight the box
      socket.on("Dehighlight",function(data){
        var canvas = document.getElementById("canvas").getContext("2d");
        Highlight(data,canvas,img,"white");
      });

      //Move the elements..
      socket.on("MoveElements",function(data){
        var canvas = document.getElementById("canvas").getContext("2d");
        MoveElements(data,canvas,img);
      });

      //When Socket connects with server for first time,
      //Server serves with gameBox array. With that array
      //We draw on canvas.
      socket.on("Game Initialized",function(data){
        var array = data.array;
        var canvas = document.getElementById("canvas").getContext("2d");
        var HEIGHT_OF_CANVAS = 400;
        var WIDTH_OF_CANVAS = 400;
        canvas.clearRect(0, 0, WIDTH_OF_CANVAS,HEIGHT_OF_CANVAS);//clear the canvas before redrawing..
        for(var i = 0; i < array.length;i++){
          if(array[i] !== null){
            //Here we are choosing element from array img on the base of element of current box.
            canvas.drawImage(img[array[i].element],array[i].xPosition,array[i].yPosition,array[i].height,array[i].width);
          }
        }//end For
      }
      );//end Socket.on
      socket.on("Redraw",function(data){
        var array = data.array;
        var canvas = document.getElementById("canvas").getContext("2d");
        var HEIGHT_OF_CANVAS = 400;
        var WIDTH_OF_CANVAS = 400;
        canvas.clearRect(0, 0, WIDTH_OF_CANVAS,HEIGHT_OF_CANVAS);//clear the canvas before redrawing..
        for(var i = 0; i < array.length;i++){
          if(array[i] !== null){
            //Here we are choosing element from array img on the base of element of current box.
            canvas.drawImage(img[array[i].element],array[i].xPosition,array[i].yPosition,array[i].height,array[i].width);
          }
        }//end For
      }
      );
      canvas.addEventListener('click',function() {
        var canvas = document.getElementById("canvas");
        var rectangleOnCanvas = canvas.getBoundingClientRect();
        var xCoord = Math.round(event.clientX - rectangleOnCanvas.left);
        var yCoord = Math.round(event.clientY - rectangleOnCanvas.top);
        socket.emit("ClickedOnCanvas",{X : xCoord, Y : yCoord});
      });
  </script>
</html>
