<html>
  <head>
    <!-- This ejs statement includes header partial.
    Varibale declaration decides which page is active !-->
    <% include head.ejs %>
    <% var page = 'gamepage'%>
    <% var active = " active"%>
  </head>
  <body>
    <% include header.ejs %>
    <div style="margin-left:10%;height:410;width:410;">
      <canvas id = "canvas" width="400" height = "400"></canvas>
    </div>
    <!--This images will be used to draw on canvas.!-->
    <img style="display:none" id = "balance" src="/balance.png"></img>
    <img style="display:none" id = "cash" src="/cash.png"></img>
    <img style="display:none" id = "cocontribution" src="/cocontribution.png"></img>
    <img style="display:none" id = "conservative" src="/conservative.png"></img>
    <img style="display:none" id = "growth" src="/growth.png"></img>
    <img style="display:none" id = "salarysacrifice" src="/salarysacrifice.png"></img>
    <img style="display:none" id = "empty" src="/empty.png"></img>
    <% include footer.ejs %>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/AnimationFunctions.js"></script>
  <script>
      var socket = io.connect();
      socket.on("SwapAnimation",function(data){
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];
        var canvas = document.getElementById("canvas").getContext("2d");
        SwapObjects(data,canvas,img);
      });

      //Highlight the selected item
      socket.on("Highlight",function(data){
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];
        var canvas = document.getElementById("canvas").getContext("2d");
        Highlight(data,canvas,img,"#33FFA5");
      });

      //Dehighlight the box
      socket.on("Dehighlight",function(data){
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];
        var canvas = document.getElementById("canvas").getContext("2d");
        Highlight(data,canvas,img,"white");
      });

      //Move the elements..
      socket.on("MoveElements",function(data){
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];
        var canvas = document.getElementById("canvas").getContext("2d");
        MoveElements(data,canvas,img,socket);
      });

      //When Socket connects with server for first time,
      //Server serves with gameBox array. With that array
      //We draw on canvas.
      socket.on("Game Initialized",function(data){
        var array = data.array;
        //This is token array. we will select elements base on the element
        //number.
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];

        var canvas = document.getElementById("canvas").getContext("2d");
        canvas.clearRect(0, 0, 400,400);//clear the canvas before redrawing..
        for(var i = 0; i < array.length;i++){
          if(array[i] !== null){
            //Here we are choosing element from array img on the base of element of current box.
            canvas.drawImage(img[array[i].element],array[i].xPosition,array[i].yPosition,array[i].height,array[i].width);
          }
        }//end For
      }
      );//end Socket.on
      socket.on("Redraw",function(data){
        var array = data.array;
        //This is token array. we will select elements base on the element
        //number.
        var img = [document.getElementById("cash"),document.getElementById("balance"),document.getElementById("cocontribution"),
        document.getElementById("conservative"),document.getElementById("growth"),document.getElementById("salarysacrifice"),
        document.getElementById("empty")];

        var canvas = document.getElementById("canvas").getContext("2d");
        canvas.clearRect(0, 0, 400,400);//clear the canvas before redrawing..
        for(var i = 0; i < array.length;i++){
          if(array[i] !== null){
            //Here we are choosing element from array img on the base of element of current box.
            canvas.drawImage(img[array[i].element],array[i].xPosition,array[i].yPosition,array[i].height,array[i].width);
          }
        }//end For
      }
      );

      canvas.addEventListener('click',function() {
        var canvas = document.getElementById("canvas");
        var rectangleOnCanvas = canvas.getBoundingClientRect();
        var xCoord = Math.round(event.clientX - rectangleOnCanvas.left);
        var yCoord = Math.round(event.clientY - rectangleOnCanvas.top);
        socket.emit("ClickedOnCanvas",{X : xCoord, Y : yCoord});
      });
  </script>
</html>
